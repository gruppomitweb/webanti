<html>
 <head>
  <title>Fields</title>
  <meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
  <link rel="stylesheet" href="extender.css" type="text/css">
  <script src="../stdFunctions.js"></script>
  <script src="../spadministration_help.js"></script>
  <script>
QueryString.keys = new Array();
QueryString.values = new Array();
var fkFields=null, fields=null;
var action;
var m_cProgName="spadministration_table_extender_relation_field";

function QueryString(key) {
	var value = null;
  for (var i=0;i<QueryString.keys.length;i++) {
    if (QueryString.keys[i]==key) {
			value = QueryString.values[i];
			break;
		}
	}
	return value;
}
function QueryString_Parse() {
	var query = window.location.search.substring(1);
	var pairs = query.split("&");

  for (var i=0;i<pairs.length;i++) {
		var pos = pairs[i].indexOf('=');
    if (pos >= 0) {
			var argname = pairs[i].substring(0,pos);
			var value = pairs[i].substring(pos+1);
			QueryString.keys[QueryString.keys.length] = argname;
			QueryString.values[QueryString.values.length] = value;
		}
	}
}
function DoLoad() {
  QueryString_Parse();

  fkFields = GetOpener().fkFields;
  fields = GetOpener().fields;
  action = QueryString("action");

  for (var i=0; i<fkFields.length; i++) {
    document.getElementById("fk").options[document.getElementById("fk").options.length] =
                new Option(fkFields[i][1]+"("+fkFields[i][0]+","+fkFields[i][2]+","+fkFields[i][3]+","+fkFields[i][4]+")", i, false);
  }
  for (var i=0; i<fields.length; i++) {
    document.getElementById("f").options[document.getElementById("f").options.length] =
                new Option(fields[i][1]+"("+fields[i][0]+","+fields[i][2]+","+fields[i][3]+","+fields[i][4]+")", i, false);
  }

  if(action=="edit") {
    document.getElementById("f").selectedIndex=QueryString("f");
    document.getElementById("fk").selectedIndex=QueryString("fk");
  }
  else if(action=="add") {
    document.getElementById("f").selectedIndex=0;
    document.getElementById("fk").selectedIndex=0;
  }
  document.getElementById("fk").focus();
}
function SelectField() {
  var fIdx = document.getElementById("f").options[document.getElementById("f").options.selectedIndex].value;
  var fkIdx = document.getElementById("fk").options[document.getElementById("fk").options.selectedIndex].value;
  GetOpener().SetField(action, QueryString("idx"), fIdx, fkIdx);
  WindowClose();
}
function CloseWindow() {
  WindowClose();
}
function ManageKeys(e) {
  if(e.keyCode==13) SelectField();
  else if(e.keyCode==27) CloseWindow();
}
function CancelEvent(e){
 e.cancelBubble=true
 if(e.stopPropagation) e.stopPropagation();
 e.returnValue=false
}
function CancelHelp(e) {
 CancelEvent(e);
 Help();
}
  </script>
 </head>

 <body onload="DoLoad()" onhelp="CancelHelp(event)" onkeydown="ManageKeys(event)" bgcolor="#D6D3CE" topmargin="0" leftmargin="0" marginwidth="0" marginheight="0" scroll="no" style="border:0px;overflow:hidden;margin:0pt">
  <table border="1" width="450" height="254" cellpadding="0" cellspacing="1" align="center">
   <tr style="height:20">
    <td class="titoli" style="width:50%" onselectstart="return false">For<u>e</u>ign table fields</td>
    <td class="titoli" style="width:50%" onselectstart="return false"><u>F</u>ields</td>
   </tr>
   <tr>
    <td>
     <select class="expression_textarea" id="fk" size="15" style="width:100%;height:100%" accesskey="k">
     </select>
    </td>
    <td>
     <select class="expression_textarea" id="f" size="15" style="width:100%;height:100%" accesskey="f">
     </select>
    </td>
   </tr>
   <tr>
    <td colspan="2" height="20" class="footer-button-container">
     <button onclick="SelectField()" accesskey="o" class="bottoni confirm"><u>O</u>K</button>&nbsp;
     <button onclick="WindowClose()" accesskey="c" class="bottoni"><u>C</u>ancel</button>
    </td>
   </tr>
  </table>
 </body>
</html>
